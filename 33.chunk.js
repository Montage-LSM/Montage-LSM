webpackJsonp([33],{228:function(e,t,a){"use strict";function s(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(e[s]=a[s])}return e},c=function(){function e(e,t){for(var a=0;a<t.length;a++){var s=t[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,a,s){return a&&e(t.prototype,a),s&&e(t,s),t}}(),l=a(1),u=s(l),d=(a(10),a(13)),m=a(2),p=a(7),f=a(5),h=m.Form.create,g=function(e){function t(e){i(this,t);var a=r(this,Object.getPrototypeOf(t).call(this,e));return a.state={pictures:[],selectedCircleID:"all"!=a.props.params.circleID&&a.props.params.circleID?a.props.params.circleID:"0",selectedPostId:"new"==a.props.params.commentID?0:a.props.params.postID,data:{postID:0,content:"",pictures:[],isVerify:1,isReport:0},isCreative:"new"==a.props.params.commentID},a.handleSubmit=a.handleSubmit.bind(a),a.getPostPictures=a.getPostPictures.bind(a),a.deletePost=a.deletePost.bind(a),a.getPostID=a.getPostID.bind(a),a.getCircleID=a.getCircleID.bind(a),a.toggleVerify=a.toggleVerify.bind(a),a.toggleReport=a.toggleReport.bind(a),a.getCommentPictures=a.getCommentPictures.bind(a),a.ajaxAddSuccess=a.ajaxAddSuccess.bind(a),a.ajaxDeleteSuccess=a.ajaxDeleteSuccess.bind(a),a.ajaxUpdateSuccess=a.ajaxUpdateSuccess.bind(a),a.ajaxDetailsSuccess=a.ajaxDetailsSuccess.bind(a),a}return o(t,e),c(t,[{key:"ajaxDeleteSuccess",value:function(){m.message.error("成功删除评论！",10),f.hashHistory.push("/circle/posts/")}},{key:"deletePost",value:function(){var e=this;m.Modal.confirm({title:"您是否确认要删除本评论",content:"评论删除之后无法恢复，请慎重。",onOk:function(){p.PRO_REQUEST.ajax.requestData(p.PRO_URL.circles.comment["delete"],{commentID:e.props.params.commentID},e.ajaxDeleteSuccess)}})}},{key:"getPostPictures",value:function(e){this.setState({pictures:e}),console.log(e),this.state.data.pictures=function(){for(var t=[],a=0;a<e.length;a++)t.push(e[a].url);return t}(),console.log(this.state.data.pictures)}},{key:"ajaxUpdateSuccess",value:function(e){this.setState({data:e}),1==this.state.isCreative&&f.hashHistory.push("/circle/posts/id/"+this.props.params.commentID),e.des&&m.message.info(e.des)}},{key:"ajaxAddSuccess",value:function(e){console.log("data",e),this.setState({data:e}),1==this.state.isCreative&&e.commentID&&f.hashHistory.push("/circle/posts/id/"+e.commentID),e.des&&m.message.info(e.des)}},{key:"handleSubmit",value:function(e){return e.preventDefault(),console.log("this.state.data:",this.state.data),0==p.PRO_COMMON.obj.isAllFieldValidated(this.state.data)?(m.message.error("无法完成"+(this.state.isCreative?"创建":"更新")+"操作，您还没有填写完全信息，请检查！",10),!1):void(0==this.state.isCreative?p.PRO_REQUEST.ajax.requestData(p.PRO_URL.circles.comment.update,Object.assign({commentID:this.props.params.commentID},this.state.data),this.ajaxUpdateSuccess):p.PRO_REQUEST.ajax.requestData(p.PRO_URL.circles.comment.add,Object.assign({postID:this.state.selectedPostId},this.state.data),this.ajaxAddSuccess))}},{key:"ajaxDetailsSuccess",value:function(e){this.setState({data:e}),this.setState({pictures:[function(){for(var t=[],a=0;a<e.pictures.length;a++)t.push({url:e.pictures[a],thumbUrl:e.pictures[a]+"?imageView2/2/w/100",name:e.pictures[a]});return t}()]}),this.forceUpdate()}},{key:"componentDidMount",value:function(){0==this.state.isCreative&&p.PRO_REQUEST.ajax.requestData(p.PRO_URL.circles.comment.details,{commentID:this.props.params.commentID},this.ajaxDetailsSuccess)}},{key:"getCircleID",value:function(e){var t=this;event.preventDefault(),console.log(e),this.setState({selectedCircleID:e}),setTimeout(function(){console.log("selectedCircleID",t.state.selectedCircleID)},2e3)}},{key:"getPostID",value:function(e){event.preventDefault(),console.log(e),this.setState({selectedPostId:e})}},{key:"checkInformation",value:function(e,t,a){t&&t.length>=100?a(new Error("请确保评论内容在1000个字以内!")):this.state.data.content=t}},{key:"getCommentPictures",value:function(e){this.setState({pictures:e}),console.log("getCommentPictures：",e),this.state.data.pictures=function(){for(var t=[],a=0;a<e.length;a++)t.push(e[a].url);return t}(),console.log(this.state.data.pictures)}},{key:"toggleVerify",value:function(e){console.log(e?"1":"0"),this.state.data.isVerify=e?"1":"0"}},{key:"toggleReport",value:function(e){console.log(e?"1":"0"),this.state.data.isReport=e?"1":"0"}},{key:"render",value:function(){var e=this,t=this.props.form,a=t.getFieldProps,s=(t.getFieldError,t.isFieldValidating,{formItemLayout:{labelCol:{span:4},wrapperCol:{span:14}},informationValidator:a("information",{rules:[{required:!0,whitespace:!1,message:"请填写评论内容"},{validator:this.checkInformation.bind(this)}]}),managerValidator:a("manager",{rules:[{required:!0,message:"请选择评论的管理员"}]})});return u["default"].createElement(m.Form,{horizontal:!0,onSubmit:this.handleSubmit,form:this.props.form},u["default"].createElement(m.Form.Item,n({},s.formItemLayout,{label:"是否通过审核："}),u["default"].createElement(m.Switch,{id:"isVerify",defaultChecked:!!this.state.data.isVerify,disabled:this.state.isCreative,checkedChildren:"开",unCheckedChildren:"关",onChange:this.toggleVerify})),u["default"].createElement(m.Form.Item,n({},s.formItemLayout,{label:"是否举报："}),u["default"].createElement(m.Switch,{id:"isReport",defaultChecked:!!this.state.data.isReport,disabled:this.state.isCreative,checkedChildren:"开",unCheckedChildren:"关",onChange:this.toggleReport})),u["default"].createElement(m.Form.Item,n({},s.formItemLayout,{label:"属于帖子："}),u["default"].createElement(d.SelectorCircle,{id:"circleOwner",isMultiple:!1,cbReceiver:this.getCircleID}),u["default"].createElement(d.SelectorPostInCircle,n({},a({initialValue:this.state.selectedPostId}),{id:"postOwner",isMultiple:!1,cbReceiver:this.getPostID,ownerCircleID:this.state.selectedCircleID}))),u["default"].createElement(m.Form.Item,n({},s.formItemLayout,{label:"评论内容："}),u["default"].createElement(m.Input,n({},s.informationValidator,{id:"content",value:this.state.data.content,type:"textarea",rows:"10"}))),u["default"].createElement(m.Form.Item,n({},s.formItemLayout,{label:"相关图片："}),u["default"].createElement(d.UploadImage,{id:"pictures",isMultiple:!0,limit:3,fileList:this.state.pictures,cbReceiver:this.getCommentPictures,fileType:"image",description:""})),u["default"].createElement(m.Form.Item,{wrapperCol:{span:14,offset:4},style:{marginTop:24}},u["default"].createElement("span",null,u["default"].createElement(m.Button,{type:"primary",htmlType:"submit"},this.state.isCreative?"创建":"更新")),function(){return 1!=e.state.isCreative?u["default"].createElement("span",null,"    ",u["default"].createElement(m.Button,{onClick:e.deletePost},"删除评论")):void 0}()))}}]),t}(l.Component);g=h()(g),g.defaultProps={showHeader:!1},e.exports=g}});