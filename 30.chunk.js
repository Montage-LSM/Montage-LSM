webpackJsonp([30],{236:function(e,t,a){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),o=a(1),l=r(o),u=a(2),f=a(5),d=a(13),v=a(7),m=function(e){function t(e){n(this,t);var a=c(this,Object.getPrototypeOf(t).call(this,e));return a.orderRow=a.orderRow.bind(a),a.ajaxListSuccess=a.ajaxListSuccess.bind(a),a.saveNewDiscovery=a.saveNewDiscovery.bind(a),a.ajaxSaveSuccess=a.ajaxSaveSuccess.bind(a),a.clearDiscovery=a.clearDiscovery.bind(a),a.ajaxClearSuccess=a.ajaxClearSuccess.bind(a),a.state={tableData:[],tableColumns:function(e){return[{title:"序号",key:"serial",render:function(e,t,a){return l["default"].createElement("span",null,a+1)}},{title:"圈子名称",dataIndex:"title",key:"title",render:function(e,t){return l["default"].createElement(f.Link,{to:"/circle/items/id/"+t.key,activeClassName:"active"},e)}},{title:"管理员",dataIndex:"manager",key:"manager"},{title:"创建时间",dataIndex:"createdTime",key:"createdTime"},{title:"排序",key:"order",render:function(t,a){return l["default"].createElement(d.TableRowDrager,{cbOrderRow:e.orderRow,showText:a.title})}},{title:"移除",key:"remove",render:function(t,a,r){return l["default"].createElement(u.Popconfirm,{title:"确定要从发现列表移除此项目？",onConfirm:function(){return e.removeFromList(a.circleID,r)}},l["default"].createElement("a",{href:"#"},l["default"].createElement(u.Icon,{type:"remove"})))}}]}(a)},a}return i(t,e),s(t,[{key:"orderRow",value:function(e,t){var a=v.PRO_COMMON.Array.moveItemToNew(this.state.tableData,e,t);this.setState({tableData:a}),u.message.success("顺序已经调整，请不要忘记保存。")}},{key:"removeFromList",value:function(e,t){var a=v.PRO_COMMON.localDB.getter("circleList");a.includes(e)?v.PRO_COMMON.Array.removeValueItem(a,e):a.push(e),v.PRO_COMMON.localDB.setter("circleList",a),v.PRO_COMMON.Array.removeByIndex(this.state.tableData,t),this.forceUpdate(),u.message.success("成功移除项目，新的顺序已经产生，请根据需要继续调整或保存。")}},{key:"ajaxClearSuccess",value:function(e){u.message.success("顺序已经清空，如果需要新的排序，请在圈子列表中重新添加。["+e.des+"]"),this.getDiscoveries()}},{key:"clearDiscovery",value:function(e){var t=this;Modal.confirm({title:"您是否确认要清空所有圈子的排序信息",content:"圈子的排序信息清空之后无法恢复，请慎重，是否继续进行清空操作？",onOk:function(){v.PRO_REQUEST.ajax.requestData(v.PRO_URL.circles.circle.clear_discoveries,{},t.ajaxClearSuccess)}})}},{key:"ajaxSaveSuccess",value:function(e){u.message.success("成功保存顺序，您可以根据需要继续调整或保存。["+e.des+"]")}},{key:"saveNewDiscovery",value:function(){var e=[];this.state.tableData.map(function(t,a){e.push({circleId:t.circleID,serialNo:a})}),console.log(e),v.PRO_REQUEST.ajax.requestData(v.PRO_URL.circles.circle.save_dicoveries,{orderInfo:e},this.ajaxSaveSuccess)}},{key:"ajaxListSuccess",value:function(e){v.PRO_COMMON.obj.refsKeyTo(e.list,""),this.setState({tableData:e.list})}},{key:"getDiscoveries",value:function(){var e=v.PRO_COMMON.localDB.getter("circleList");v.PRO_REQUEST.ajax.requestData(v.PRO_URL.circles.circle.get_dicoveries,{circleIDs:e},this.ajaxListSuccess)}},{key:"componentWillMount",value:function(){this.getDiscoveries()}},{key:"render",value:function(){return l["default"].createElement("div",null,this.props.children||l["default"].createElement("div",null,l["default"].createElement(u.Table,{columns:this.state.tableColumns,dataSource:this.state.tableData,pagination:!1,rowClassName:function(e){return 999==e.orderNo?"noSerialTableRow":""}}),l["default"].createElement("br",null),l["default"].createElement(u.Button,{type:"primary",onClick:this.saveNewDiscovery},"保存顺序"),"    ",l["default"].createElement(u.Button,{onClick:this.clearDiscovery},"清空排序")))}}]),t}(o.Component);m.defaultProps={showHeader:!1},e.exports=m}});