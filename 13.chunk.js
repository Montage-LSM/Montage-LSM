webpackJsonp([13],{238:function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),l=n(1),c=o(l),u=n(2);n(5);e.exports=function(e){function t(){return a(this,t),r(this,Object.getPrototypeOf(t).apply(this,arguments))}return s(t,e),i(t,[{key:"render",value:function(){return c["default"].createElement(u.Alert,{message:"帖子列表，需求与疑问请向技术部提出",type:"info"})}}]),t}(l.Component)},239:function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),l=n(1),c=o(l),u=n(2),p=n(5),f=n(10),d=n(13),m=(n(7),function(e){function t(e){a(this,t);var n=r(this,Object.getPrototypeOf(t).call(this,e));return n.queryPosts=n.queryPosts.bind(n),n.changeCircle=n.changeCircle.bind(n),n.state={circleID:0,isListAll:"all"==f.Global.get(n.props.location.pathname.substr(0,n.props.location.pathname.lastIndexOf("/"))).circleID},n}return s(t,e),i(t,[{key:"createPost",value:function(e){p.hashHistory.push(e+"/id/new")}},{key:"queryPosts",value:function(){this.props.broadcast("adfasdfasd")}},{key:"changeCircle",value:function(e){p.hashHistory.push("/circle/posts/"+e);var t=this.props.location.pathname.substr(0,this.props.location.pathname.lastIndexOf("/"));this.setState({isListAll:"all"==f.Global.get(t).circleID}),this.props.broadcast({type:"changeCircle",data:{circleID:e,isListAll:this.state.isListAll}})}},{key:"render",value:function(){var e=this,t=this.props.location.pathname;return c["default"].createElement(f.TopBar,{handleSubmit:this.queryPosts},c["default"].createElement(u.Button,{onClick:function(){return e.createPost(t)}},"新建帖子"),function(){return e.state.isListAll?c["default"].createElement(u.Button,{onClick:function(){return p.hashHistory.push(e.props.location.pathname+"/top")}},"精选排序"):c["default"].createElement(u.Button,{onClick:function(){return p.hashHistory.push(e.props.location.pathname+"/serial")}},"帖子排序")}(),c["default"].createElement(d.SelectorCircle,{id:"circleOwner",isMultiple:!1,cbReceiver:this.changeCircle,initialValue:this.state.ownerCircleName,labelInBar:"只显示："}),function(){return e.state.isListAll?void 0:c["default"].createElement(u.Button,{onClick:function(){return e.changeCircle("all")}},"显示所有圈子的帖子")}())}}]),t}(l.Component));m.defaultProps={componentGotNotify:m.prototype.componentGotNotify},e.exports=m},240:function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),l=n(1),c=o(l),u=n(2),p=n(5),f=n(7),d=n(10),m=n(13),h=null,g=function(e){function t(e){a(this,t);var n=r(this,Object.getPrototypeOf(t).call(this,e));return setTimeout(function(){h=n},100),n.toggleReport=n.toggleReport.bind(n),n.getCircleName=n.getCircleName.bind(n),n.showUpdateVerifyConfirm=n.showUpdateVerifyConfirm.bind(n),n.deletePost=n.deletePost.bind(n),n.changeOfReply=n.changeOfReply.bind(n),n.showModalOfReply=n.showModalOfReply.bind(n),n.getCommentPictures=n.getCommentPictures.bind(n),n.handleOkOfReply=n.handleOkOfReply.bind(n),n.handleCancelOfReply=n.handleCancelOfReply.bind(n),n.ajaxDeletePostSuccess=n.ajaxDeletePostSuccess.bind(n),n.ajaxPostAddCommentSuccess=n.ajaxPostAddCommentSuccess.bind(n),n.ajaxListSuccess=n.ajaxListSuccess.bind(n),n.ajaxToggleReportSuccess=n.ajaxToggleReportSuccess.bind(n),n.ajaxCircleNameSuccess=n.ajaxCircleNameSuccess.bind(n),n.saveToOrderList=n.saveToOrderList.bind(n),n.state={visibleOfReply:!1,ownerCircleName:"",lastCircleID:0,commentImages:[],isListAll:"all"==d.Global.get(n.props.location.pathname.substr(0,n.props.location.pathname.lastIndexOf("/"))).circleID,orderListID:f.PRO_COMMON.localDB.getter("orderPostListInCircle"+d.Global.get(n.props.location.pathname.substr(0,n.props.location.pathname.lastIndexOf("/"))).circleID)||[],tableConfig:{total:0,pageSize:10,pageIndex:0},tableData:[],tableColumns:function(e){return[{title:"帖子内容预览",dataIndex:"content",key:"content",render:function(e,t){return c["default"].createElement(p.Link,{to:"/circle/comments/"+t.postID,title:"点击浏览属于此帖子的评论列表",activeClassName:"active"},e.substr(0,20))}},{title:"发帖人",dataIndex:"creator",key:"creator"},{title:"创建时间",dataIndex:"createdTime",key:"createdTime"},{title:"图片数量",dataIndex:"picturesCount",key:"picturesCount"},{title:"审核状态",dataIndex:"isVerify",key:"isVerify",render:function(t,n){return function(){return[function(){return c["default"].createElement(u.Badge,{dot:!0},c["default"].createElement(u.Button,{type:"primary",onClick:function(){e.showUpdateVerifyConfirm(n.postID,n.content)}},"待审核"))}(),c["default"].createElement(u.Tag,{style:{backgroundColor:"#87d068"}},"通过审核"),c["default"].createElement(u.Tag,{style:{backgroundColor:"#FAC450"}},"审核不通过")][parseInt(n.isVerify)]}()}},{title:"举报状态",dataIndex:"isReport",key:"isReport",render:function(e,t){return function(){return[c["default"].createElement(u.Tag,{style:{backgroundColor:"#ddd"}},"无举报"),c["default"].createElement(u.Tag,{style:{backgroundColor:"#87d068"}},"抄袭或未授权转载"),c["default"].createElement(u.Tag,{style:{backgroundColor:"#87d068"}},"广告或垃圾信息"),c["default"].createElement(u.Tag,{style:{backgroundColor:"#FAC450"}},"其他：[见详细信息]")][parseInt(t.isReport)]}()}},{title:"准备排序",dataIndex:"postID",key:"postID",render:function(t,n){return c["default"].createElement(u.Checkbox,{className:"ant-checkbox-inline",onChange:function(){return e.saveToOrderList(n.postID,n.content)},checked:function(e){return e.state.orderListID.includes(n.postID)}(e)},function(){return n.orderNo?"已排序(当前位置["+n.orderNo+"])":"可排序"}())}},{title:"操作",key:"operation",render:function(t,n){var o=d.Global.get(e.props.location.pathname.substr(0,e.props.location.pathname.lastIndexOf("/"))).circleID;return c["default"].createElement("span",null,c["default"].createElement(u.Popconfirm,{title:"确定要删除此帖子？此操作属于危险操作，删除后无法恢复，请确认是否继续。",onConfirm:function(){return e.deletePost(n.postID)}},c["default"].createElement("a",{href:"javascript: void 0;"},"删除")),c["default"].createElement("span",{className:"ant-divider"}),c["default"].createElement("a",{href:"javascript: void 0;"},"关联商品活动"),c["default"].createElement("span",{className:"ant-divider"}),c["default"].createElement("a",{onClick:function(){return e.showModalOfReply(n.postID)}},"回复"),c["default"].createElement("span",{className:"ant-divider"}),c["default"].createElement(p.Link,{to:"/circle/posts/"+o+"/id/"+n.postID,activeClassName:"active"},"详细信息",c["default"].createElement(u.Icon,{type:"down"})))}}]}(n)},n}return s(t,e),i(t,[{key:"ajaxPostAddCommentSuccess",value:function(e){this.setState({visibleOfReply:!1}),u.message.info(e.des,5)}},{key:"changeOfReply",value:function(e){this.setState({contentOfReply:e.target.value})}},{key:"handleOkOfReply",value:function(){var e=this.state.contentOfReply;e?f.PRO_REQUEST.ajax.requestData(f.PRO_URL.circles.comment.add,{postID:this.state.postIDOfReply,content:e},this.ajaxPostAddCommentSuccess,function(){u.message.error("抱歉，回复该帖子时遇到错误！",5)}):u.message.error("抱歉，帖子的回复内容错误！",5)}},{key:"handleCancelOfReply",value:function(){this.setState({visibleOfReply:!1})}},{key:"showModalOfReply",value:function(e){this.setState({postIDOfReply:e,visibleOfReply:!0})}},{key:"ajaxDeletePostSuccess",value:function(e){0==e.rc?(u.message.success(e.des),this.getList()):u.message.error(e.des)}},{key:"deletePost",value:function(e){f.PRO_REQUEST.ajax.requestData(f.PRO_URL.circles.post["delete"],{postID:e},this.ajaxDeletePostSuccess,function(){u.message.error("抱歉,删除该帖子状态时遇到错误！",5)})}},{key:"ajaxToggleVerifySuccess",value:function(e){0==e.rc?(u.message.success(e.des),this.getList()):u.message.error(e.des)}},{key:"toggleVerify",value:function(e,t){f.PRO_REQUEST.ajax.requestData(f.PRO_URL.circles.comment.update_verify,{postID:e,status:t},this.ajaxToggleVerifySuccess,function(){u.message.error("抱歉,审核该帖子状态时遇到错误！",5)})}},{key:"showUpdateVerifyConfirm",value:function(e,t){!function(n){u.Modal.confirm({title:"该帖子内容尚未经审核，请确认",content:"帖子内容："+t,cancelText:"审核不通过（合规）",okText:"审核通过（违规）",width:600,onOk:function(){n.toggleVerify(e,2)},onCancel:function(){n.toggleVerify(e,1)}})}(this)}},{key:"saveToOrderList",value:function(e,t){var n=this.state.orderListID;n.includes(e)?(f.PRO_COMMON.Array.removeValueItem(n,e),u.message.info("已经取消帖子“"+t+"”的排序属性，勾选以准备排序！",10)):(n.push(e),u.message.info("帖子“"+t+"”已经设置为可以排序，请跳转到发现列表进行排序操作！",10)),this.setState({orderListID:n});var o=d.Global.get(this.props.location.pathname.substr(0,this.props.location.pathname.lastIndexOf("/"))).circleID;f.PRO_COMMON.localDB.setter("orderPostListInCircle"+o,n),this.forceUpdate()}},{key:"showUpdateReportConfirm",value:function(e,t){!function(n){u.Modal.confirm({title:"该帖子被用户审核,请确认处理结果",content:"帖子内容："+t,cancelText:"审核不通过（未违规）",okText:"审核通过（确定违规）",width:600,onOk:function(){n.toggleReport(e,1)},onCancel:function(){n.toggleReport(e,0)}})}(this)}},{key:"ajaxToggleReportSuccess",value:function(e){0==e.rc?(u.message.success(e.des),this.getList()):u.message.error(e.des)}},{key:"ajaxToggleReportError",value:function(){u.message.error("抱歉,该帖子审核状态切换时遇到错误！",5)}},{key:"toggleReport",value:function(e,t){f.PRO_REQUEST.ajax.requestData(f.PRO_URL.circles.post.update_report,{postID:e,status:t},this.ajaxToggleReportSuccess,this.ajaxToggleReportError)}},{key:"ajaxListSuccess",value:function(e){var e={rc:"0",des:"返回成功",countNo:"1000",pageIndex:"0",list:[{postID:"1001",createor:"1001",content:"帖子内容帖子内容帖子内容帖子内容帖子内容帖子内容",picturesCount:9,isReport:1,isVerify:1,commentsCount:100,lastCommentUserID:"1001",lastCommentTime:"2016-5-13 14:19:38",createdTime:"2016年5月1日",orderNo:""},{postID:"1002",createor:"1001",content:"帖子内容帖子内容帖子内容帖子内容帖子内容帖子内容",picturesCount:9,isReport:0,isVerify:0,commentsCount:100,lastCommentUserID:"1001",lastCommentTime:"2016-5-13 14:19:38",createdTime:"2016年5月1日",orderNo:""},{postID:"1003",createor:"1001",content:"帖子内容帖子内容帖子内容帖子内容帖子内容帖子内容",picturesCount:9,isReport:0,isVerify:0,commentsCount:100,lastCommentUserID:"1001",lastCommentTime:"2016-5-13 14:19:38",createdTime:"2016年5月1日",orderNo:""},{postID:"1004",createor:"1001",content:"帖子内容帖子内容帖子内容帖子内容帖子内容帖子内容",picturesCount:9,isReport:2,isVerify:2,commentsCount:100,lastCommentUserID:"1001",lastCommentTime:"2016-5-13 14:19:38",createdTime:"2016年5月1日",orderNo:""},{postID:"1005",createor:"1001",content:"帖子内容帖子内容帖子内容帖子内容帖子内容帖子内容",picturesCount:9,isReport:3,isVerify:0,commentsCount:100,lastCommentUserID:"1001",lastCommentTime:"2016-5-13 14:19:38",createdTime:"2016年5月1日",orderNo:""}]};f.PRO_COMMON.obj.refsKeyTo(e.list,""),this.setState({tableData:e.list})}},{key:"ajaxCircleNameSuccess",value:function(e){this.setState({ownerCircleName:e.title}),this.forceUpdate()}},{key:"getCircleName",value:function(){var e=d.Global.get(this.props.location.pathname.substr(0,this.props.location.pathname.lastIndexOf("/"))).circleID;f.PRO_REQUEST.ajax.requestData(f.PRO_URL.circles.circle.details,{circleID:e},this.ajaxCircleNameSuccess)}},{key:"getList",value:function(){console.log(this.get_list_data),f.PRO_REQUEST.ajax.requestData(f.PRO_URL.circles.post.get_list,this.get_list_data,this.ajaxListSuccess,this.ajaxListSuccess)}},{key:"getCommentPictures",value:function(e){console.log("imageData: ",e);var t=[];this.setState({commentImages:t})}},{key:"componentDidMount",value:function(){this.getList(),this.getCircleName()}},{key:"componentGotNotify",value:function(e){switch(console.log("got data: ",e),e.type){case"changeCircle":h.setState({isListAll:e.data.isListAll}),h.getList()}}},{key:"render",value:function(){var e={getCheckboxProps:function(e){return{disabled:"胡彦祖"===e.name}}};return c["default"].createElement("div",null,this.props.children||c["default"].createElement(u.Table,{rowSelection:e,columns:this.state.tableColumns,dataSource:this.state.tableData,expandedRowRender:function(e){return c["default"].createElement("p",null,e.content)},pagination:this.pagination}),c["default"].createElement(u.Modal,{title:"快捷回复",visible:this.state.visibleOfReply,onOk:this.handleOkOfReply,onCancel:this.handleCancelOfReply},c["default"].createElement(u.Form,null,c["default"].createElement(u.Form.Item,null,c["default"].createElement(u.Input,{type:"textarea",ref:"replyContent",placeholder:"请填写回复内容",rows:"3",onChange:this.changeOfReply})),c["default"].createElement(u.Form.Item,null,c["default"].createElement(m.UploadImage,{id:"pictures",fileList:this.state.pictures,cbReceiver:this.getCommentPictures,isMultiple:!0,limit:3})))))}},{key:"pagination",get:function(){return function(e){return{total:e.state.tableData.countNo,showSizeChanger:!0,showQuickJumper:!0,onShowSizeChange:function(t,n){e.state.tableConfig.pageSize=n,e.state.tableConfig.pageIndex=t-1,e.getList()},onChange:function(t){e.state.tableConfig.pageIndex=t-1,e.getList()}}}(this)}},{key:"get_list_data",get:function(){console.log(this.props.location.pathname.substr(0,this.props.location.pathname.lastIndexOf("/")));var e=d.Global.get(this.props.location.pathname.substr(0,this.props.location.pathname.lastIndexOf("/"))).circleID;return this.state.isListAll||"all"==e?{pageSize:this.state.tableConfig.pageSize,pageIndex:this.state.tableConfig.pageIndex}:{circleID:e,pageSize:this.state.tableConfig.pageSize,pageIndex:this.state.tableConfig.pageIndex}}}]),t}(l.Component);g.defaultProps={componentGotNotify:function(e){return g.prototype.componentGotNotify(e)}},e.exports=g}});