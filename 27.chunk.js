webpackJsonp([27],{245:function(e,t,a){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var c=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),i=a(1),l=r(i),u=a(2),m=a(5),d=a(13),f=a(7),p=function(e){function t(e){n(this,t);var a=o(this,Object.getPrototypeOf(t).call(this,e));return a.orderRow=a.orderRow.bind(a),a.ajaxListSuccess=a.ajaxListSuccess.bind(a),a.ajaxListFaild=a.ajaxListFaild.bind(a),a.saveNewStarList=a.saveNewStarList.bind(a),a.ajaxSaveSuccess=a.ajaxSaveSuccess.bind(a),a.clearStar=a.clearStar.bind(a),a.ajaxClearSuccess=a.ajaxClearSuccess.bind(a),a.state={tableData:[],tableColumns:function(e){return[{title:"序号",key:"serial",render:function(e,t,a){return l["default"].createElement("span",null,a+1)}},{title:"帖子内容预览",dataIndex:"content",key:"content",render:function(e,t){return l["default"].createElement(m.Link,{to:"/circle/comments/"+t.postID,title:"点击浏览属于此帖子的评论列表",activeClassName:"active"},e)}},{title:"发帖人",dataIndex:"createor",key:"createor"},{title:"创建时间",dataIndex:"createdTime",key:"createdTime"},{title:"图片数量",dataIndex:"picturesCount",key:"picturesCount"},{title:"审核状态",dataIndex:"isReport",key:"isReport",render:function(e,t){return function(){return[l["default"].createElement(u.Badge,{count:"正常",style:{backgroundColor:"#87d068"}}),l["default"].createElement(u.Badge,{count:"审核中",style:{backgroundColor:"#ff5500"}}),l["default"].createElement(u.Badge,{count:"已处理",style:{backgroundColor:"#2db7f5"}})][parseInt(t.isReport)]}()}},{title:"排序",key:"order",render:function(t,a){return l["default"].createElement(d.TableRowDrager,{cbOrderRow:e.orderRow,showText:a.title})}},{title:"移除",key:"remove",render:function(t,a,r){return l["default"].createElement(u.Popconfirm,{title:"确定要从发现列表移除此项目？",onConfirm:function(){return e.removeFromList(a.postID,r)}},l["default"].createElement("a",{href:"#"},l["default"].createElement(u.Icon,{type:"remove"})))}}]}(a)},a}return s(t,e),c(t,[{key:"orderRow",value:function(e,t){var a=f.PRO_COMMON.Array.moveItemToNew(this.state.tableData,e,t);this.setState({tableData:a}),u.message.success("顺序已经调整，请不要忘记保存。")}},{key:"removeFromList",value:function(e,t){var a=f.PRO_COMMON.localDB.getter("circleList");a.includes(e)?f.PRO_COMMON.Array.removeValueItem(a,e):a.push(e),f.PRO_COMMON.localDB.setter("circleList",a),f.PRO_COMMON.Array.removeByIndex(this.state.tableData,t),this.forceUpdate(),u.message.success("成功移除项目，新的顺序已经产生，请根据需要继续调整或保存。")}},{key:"ajaxClearSuccess",value:function(e){u.message.success("顺序已经清空，如果需要新的排序，请在帖子列表中重新添加。["+e.des+"]"),this.getStars()}},{key:"clearStar",value:function(e){var t=this;u.Modal.confirm({title:"您是否确认要清空所有帖子的排序信息",content:"帖子的排序信息清空之后无法恢复，请慎重，是否继续进行清空操作？",onOk:function(){f.PRO_REQUEST.ajax.requestData(f.PRO_URL.circles.post.clear_stars,{},t.ajaxClearSuccess)}})}},{key:"ajaxSaveSuccess",value:function(e){u.message.success("成功保存顺序，您可以根据需要继续调整或保存。["+e.des+"]")}},{key:"saveNewStarList",value:function(){var e=[];this.state.tableData.map(function(t,a){e.push({postID:t.postID,serialNo:a})}),console.log(e),f.PRO_REQUEST.ajax.requestData(f.PRO_URL.circles.post.save_stars,{orderInfo:e},this.ajaxSaveSuccess)}},{key:"ajaxListSuccess",value:function(e){f.PRO_COMMON.obj.refsKeyTo(e.list,""),this.setState({tableData:e.list})}},{key:"ajaxListFaild",value:function(e){var e={rc:"0",des:"返回成功",countNo:"1000",pageIndex:"0",list:[{postID:"1001",createor:"1001",content:"帖子内容帖子内容帖子内容帖子内容帖子内容帖子内容",picturesCount:9,isReport:1,commentsCount:100,lastCommentUserID:"1001",lastCommentTime:"2016-5-13 14:19:38",createdTime:"2016年5月1日",orderNo:""},{postID:"1002",createor:"1001",content:"帖子内容帖子内容帖子内容帖子内容帖子内容帖子内容",picturesCount:9,isReport:0,commentsCount:100,lastCommentUserID:"1001",lastCommentTime:"2016-5-13 14:19:38",createdTime:"2016年5月1日",orderNo:""},{postID:"1003",createor:"1001",content:"帖子内容帖子内容帖子内容帖子内容帖子内容帖子内容",picturesCount:9,isReport:0,commentsCount:100,lastCommentUserID:"1001",lastCommentTime:"2016-5-13 14:19:38",createdTime:"2016年5月1日",orderNo:""},{postID:"1004",createor:"1001",content:"帖子内容帖子内容帖子内容帖子内容帖子内容帖子内容",picturesCount:9,isReport:2,commentsCount:100,lastCommentUserID:"1001",lastCommentTime:"2016-5-13 14:19:38",createdTime:"2016年5月1日",orderNo:""},{postID:"1005",createor:"1001",content:"帖子内容帖子内容帖子内容帖子内容帖子内容帖子内容",picturesCount:9,isReport:0,commentsCount:100,lastCommentUserID:"1001",lastCommentTime:"2016-5-13 14:19:38",createdTime:"2016年5月1日",orderNo:""}]};f.PRO_COMMON.obj.refsKeyTo(e.list,""),this.setState({tableData:e.list})}},{key:"getStars",value:function(){var e=f.PRO_COMMON.localDB.getter("circleList");f.PRO_REQUEST.ajax.requestData(f.PRO_URL.circles.post.get_stars,{postIDs:e},this.ajaxListSuccess,this.ajaxListFaild)}},{key:"componentWillMount",value:function(){this.getStars()}},{key:"render",value:function(){return l["default"].createElement("div",null,this.props.children||l["default"].createElement("div",null,l["default"].createElement(u.Table,{columns:this.state.tableColumns,dataSource:this.state.tableData,rowClassName:function(e){return 999==e.orderNo?"noSerialTableRow":""}}),l["default"].createElement("br",null),l["default"].createElement(u.Button,{type:"primary",onClick:this.saveNewStarList},"保存顺序"),"    ",l["default"].createElement(u.Button,{onClick:this.clearStar},"清空排序")))}}]),t}(i.Component);p.defaultProps={showHeader:!1},e.exports=p}});